<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - ISRS</title>
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Marcellus&family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'PT Serif', Georgia, serif;
      background: #f8f9fa;
      color: #1f2937;
    }

    /* Sidebar Navigation */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 260px;
      background: white;
      border-right: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      z-index: 100;
    }

    .sidebar-header {
      padding: 1.5rem 1.25rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .sidebar-logo {
      font-family: 'Marcellus', Georgia, serif;
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--primary-blue);
      text-decoration: none;
      display: block;
    }

    .sidebar-subtitle {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    .sidebar-nav {
      flex: 1;
      padding: 1.5rem 0;
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: 1.5rem;
    }

    .nav-section-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #9ca3af;
      padding: 0 1.25rem;
      margin-bottom: 0.5rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.25rem;
      color: #4b5563;
      text-decoration: none;
      transition: all 0.2s;
      font-size: 0.95rem;
      border-left: 3px solid transparent;
    }

    .nav-item:hover {
      background: #f3f4f6;
      color: var(--primary-blue);
      border-left-color: var(--primary-blue);
    }

    .nav-item.active {
      background: #eff6ff;
      color: var(--primary-blue);
      border-left-color: var(--primary-blue);
      font-weight: 600;
    }

    .nav-icon {
      font-size: 1.25rem;
      width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 1rem 1.25rem;
      border-top: 1px solid #e5e7eb;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1rem;
    }

    .user-details {
      flex: 1;
      min-width: 0;
    }

    .user-email {
      font-size: 0.875rem;
      font-weight: 600;
      color: #1f2937;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-role {
      font-size: 0.75rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .btn-logout {
      width: 100%;
      padding: 0.625rem 1rem;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 600;
      color: #4b5563;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'PT Serif', Georgia, serif;
    }

    .btn-logout:hover {
      background: #e5e7eb;
      color: #1f2937;
    }

    /* Main Content */
    .main-content {
      margin-left: 260px;
      min-height: 100vh;
    }

    .top-bar {
      background: white;
      border-bottom: 1px solid #e5e7eb;
      padding: 1.25rem 2rem;
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2rem;
    }

    .top-bar h1 {
      font-family: 'Marcellus', Georgia, serif;
      font-size: 1.75rem;
      color: #1f2937;
      margin-bottom: 0.25rem;
    }

    .top-bar p {
      color: #6b7280;
      font-size: 0.95rem;
    }

    /* System Status */
    .system-status {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.5rem;
    }

    .status-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #9ca3af;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: #f0fdf4;
      border-radius: 6px;
      border: 1px solid #86efac;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #22c55e;
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    .status-text {
      font-size: 0.875rem;
      font-weight: 600;
      color: #166534;
    }

    .content-wrapper {
      padding: 2rem;
      max-width: 1400px;
    }

    /* Alert Banner */
    .alert-banner {
      background: linear-gradient(135deg, var(--accent-teal) 0%, #2e8b9e 100%);
      color: white;
      padding: 1.5rem 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .alert-content h2 {
      font-family: 'Marcellus', Georgia, serif;
      font-size: 1.35rem;
      margin-bottom: 0.5rem;
    }

    .alert-content p {
      font-size: 1rem;
      opacity: 0.95;
    }

    .alert-actions {
      display: flex;
      gap: 0.75rem;
      flex-shrink: 0;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
      border: none;
      font-family: 'PT Serif', Georgia, serif;
      white-space: nowrap;
    }

    .btn-primary {
      background: white;
      color: var(--primary-blue);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Key Metrics */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .metric-card {
      background: white;
      padding: 1.75rem;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      transition: all 0.3s;
    }

    .metric-card:hover {
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
    }

    .metric-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .metric-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .metric-icon {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .metric-value {
      font-size: 2.75rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.5rem;
      line-height: 1;
    }

    .metric-description {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .loading-dots {
      animation: blink 1.4s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    /* Quick Actions */
    .section {
      margin-bottom: 2.5rem;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
    }

    .section-title {
      font-family: 'Marcellus', Georgia, serif;
      font-size: 1.5rem;
      color: #1f2937;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-icon {
      font-size: 1.75rem;
    }

    .actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.25rem;
    }

    .action-card {
      background: white;
      padding: 1.75rem;
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      text-decoration: none;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
      position: relative;
      overflow: hidden;
    }

    .action-card:hover {
      border-color: var(--primary-blue);
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15);
      transform: translateY(-4px);
    }

    .action-card-icon {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      background: #f3f4f6;
    }

    .action-card-title {
      font-size: 1.125rem;
      font-weight: 700;
      color: #1f2937;
    }

    .action-card-description {
      font-size: 0.875rem;
      color: #6b7280;
      line-height: 1.5;
    }

    /* Collapsible Section */
    .collapsible-section {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      overflow: hidden;
    }

    .collapsible-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem 1.75rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .collapsible-header:hover {
      background: #f9fafb;
    }

    .collapsible-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.125rem;
      font-weight: 700;
      color: #1f2937;
    }

    .collapsible-toggle {
      font-size: 1.5rem;
      color: #9ca3af;
      transition: transform 0.3s;
    }

    .collapsible-toggle.open {
      transform: rotate(180deg);
    }

    .collapsible-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .collapsible-content.open {
      max-height: 2000px;
    }

    .collapsible-inner {
      padding: 0 1.75rem 1.75rem 1.75rem;
    }

    .financial-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.25rem;
    }

    .financial-item {
      background: #f9fafb;
      padding: 1.25rem;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .financial-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .financial-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: #4b5563;
    }

    .financial-account {
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .financial-amount {
      font-size: 1.75rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.5rem;
    }

    .financial-note {
      font-size: 0.75rem;
      color: #6b7280;
      line-height: 1.5;
    }

    .link-list {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
    }

    .link-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1.125rem 1.5rem;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      text-decoration: none;
      color: var(--primary-blue);
      font-size: 1.05rem;
      font-weight: 600;
      transition: all 0.2s;
      flex: 1;
      min-width: 200px;
    }

    .link-item span {
      font-size: 1.5rem;
    }

    .link-item:hover {
      background: #eff6ff;
      border-color: var(--primary-blue);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 768px) {
      .link-list {
        flex-direction: column;
      }

      .link-item {
        flex: none;
      }
    }

    /* Status Badge */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: #d1fae5;
      color: #065f46;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #10b981;
    }

    /* Mobile Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s;
      }

      .sidebar.mobile-open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-btn {
        display: block;
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--primary-blue);
        color: white;
        border: none;
        font-size: 1.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        z-index: 200;
      }

      .alert-banner {
        flex-direction: column;
        text-align: center;
      }

      .alert-actions {
        flex-direction: column;
        width: 100%;
      }

      .btn {
        width: 100%;
      }

      .metrics-grid,
      .actions-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 640px) {
      .content-wrapper {
        padding: 1rem;
      }

      .top-bar {
        padding: 1rem;
      }

      .metric-value {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar Navigation -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <a href="/admin/dashboard.html" class="sidebar-logo">ISRS Admin</a>
      <div class="sidebar-subtitle" style="font-size: 0.85rem; font-weight: 600;">Management Portal</div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <a href="/" target="_blank" class="nav-item" style="background: #eff6ff; border-left-color: var(--accent-teal);">
          <span class="nav-icon">üåê</span>
          <span>View Main Website</span>
          <span style="margin-left: auto; font-size: 0.875rem;">‚Üó</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Overview</div>
        <a href="/admin/dashboard.html" class="nav-item active">
          <span class="nav-icon">üìä</span>
          <span>Dashboard</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Data Management</div>
        <a href="/admin/contacts.html" class="nav-item">
          <span class="nav-icon">üë•</span>
          <span>Contacts</span>
        </a>
        <a href="/admin/organizations.html" class="nav-item">
          <span class="nav-icon">üè¢</span>
          <span>Organizations</span>
        </a>
        <a href="/admin/conferences.html" class="nav-item">
          <span class="nav-icon">üìÖ</span>
          <span>Conferences</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Governance</div>
        <a href="/admin/votes.html" class="nav-item">
          <span class="nav-icon">üó≥Ô∏è</span>
          <span>Board Votes</span>
        </a>
        <a href="/admin/funding.html" class="nav-item">
          <span class="nav-icon">üí∞</span>
          <span>Funding</span>
        </a>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">System</div>
        <a href="/admin/settings.html" class="nav-item">
          <span class="nav-icon">‚öôÔ∏è</span>
          <span>Settings</span>
        </a>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="user-profile">
        <div class="user-avatar" id="userAvatar">A</div>
        <div class="user-details">
          <div class="user-email" id="userEmail">Loading...</div>
          <div class="user-role" id="userRole">Admin</div>
        </div>
      </div>
      <button class="btn-logout" onclick="logout()">Sign Out</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Bar -->
    <div class="top-bar">
      <div>
        <h1>Dashboard</h1>
        <p>Welcome back! Here's what's happening with ISRS today.</p>
      </div>
      <div class="system-status">
        <div class="status-label">System Status</div>
        <div class="status-indicator">
          <span class="status-dot"></span>
          <span class="status-text">All systems operational</span>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="content-wrapper">
      <!-- Conference Alert Banner -->
      <div class="alert-banner">
        <div class="alert-content">
          <h2>ICSR2026 Registration Now Open!</h2>
          <p>October 4-8, 2026 | Registration opens December 1, 2025</p>
        </div>
        <div class="alert-actions">
          <a href="/conference/register.html" target="_blank" class="btn btn-primary">Public Portal</a>
          <a href="/admin/conferences.html" class="btn btn-secondary">Manage</a>
        </div>
      </div>

      <!-- Key Metrics -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Total Contacts</div>
            <div class="metric-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white;">üë•</div>
          </div>
          <div class="metric-value" id="metricContacts"><span class="loading-dots">...</span></div>
          <div class="metric-description">Network members worldwide</div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">Organizations</div>
            <div class="metric-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white;">üè¢</div>
          </div>
          <div class="metric-value" id="metricOrgs"><span class="loading-dots">...</span></div>
          <div class="metric-description">Partner institutions</div>
        </div>

        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-title">ICSR2026 Registrations</div>
            <div class="metric-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">üìÖ</div>
          </div>
          <div class="metric-value" id="metricRegistrations"><span class="loading-dots">...</span></div>
          <div class="metric-description">Opens December 2025</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <section class="section">
        <div class="section-header">
          <h2 class="section-title">
            <span class="section-icon">‚ö°</span>
            Quick Actions
          </h2>
        </div>
        <div class="actions-grid">
          <a href="/admin/contacts.html" class="action-card">
            <div class="action-card-icon" style="background: #eff6ff; color: #3b82f6;">üë•</div>
            <div class="action-card-title">Manage Contacts</div>
            <div class="action-card-description">View and edit network members, add new contacts</div>
          </a>

          <a href="/admin/organizations.html" class="action-card">
            <div class="action-card-icon" style="background: #f5f3ff; color: #8b5cf6;">üè¢</div>
            <div class="action-card-title">View Organizations</div>
            <div class="action-card-description">Browse partner institutions and affiliates</div>
          </a>

          <a href="/admin/conferences.html" class="action-card">
            <div class="action-card-icon" style="background: #fef3c7; color: #f59e0b;">üìÖ</div>
            <div class="action-card-title">Conference Manager</div>
            <div class="action-card-description">Manage ICSR2026 registrations and details</div>
          </a>

          <a href="/admin/votes.html" class="action-card">
            <div class="action-card-icon" style="background: #dbeafe; color: #0284c7;">üó≥Ô∏è</div>
            <div class="action-card-title">Board Voting</div>
            <div class="action-card-description">Review votes and governance decisions</div>
          </a>
        </div>
      </section>

      <!-- Financial Details (Collapsible) -->
      <div class="collapsible-section">
        <div class="collapsible-header" onclick="toggleCollapsible('financials')">
          <div class="collapsible-title">
            <span>üí∞</span>
            Financial Overview & Accounts
          </div>
          <span class="collapsible-toggle" id="financials-toggle">‚ñº</span>
        </div>
        <div class="collapsible-content" id="financials-content">
          <div class="collapsible-inner">
            <div class="financial-grid">
              <div class="financial-item">
                <div class="financial-header">
                  <div class="financial-label">üí≥ Business Credit</div>
                  <div class="financial-account">...5704</div>
                </div>
                <div class="financial-amount">$8,000.00</div>
                <div class="financial-note">Available Credit</div>
                <div class="financial-note" style="margin-top: 0.5rem; background: #fef3c7; padding: 0.5rem; border-radius: 4px;">
                  üí° Earn 90,000 bonus points with $8,000 spend by Nov 12, 2025
                </div>
              </div>

              <div class="financial-item">
                <div class="financial-header">
                  <div class="financial-label">üè¶ Checking Account</div>
                  <div class="financial-account">...7718</div>
                </div>
                <div class="financial-amount" id="checkingBalance"><span class="loading-dots">...</span></div>
                <div class="financial-note">Current balance</div>
              </div>

              <div class="financial-item">
                <div class="financial-header">
                  <div class="financial-label">üíµ Savings Account</div>
                  <div class="financial-account">...0717</div>
                </div>
                <div class="financial-amount" id="savingsBalance"><span class="loading-dots">...</span></div>
                <div class="financial-note">Current balance</div>
              </div>
            </div>

            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb;">
              <h4 style="font-size: 1rem; font-weight: 700; color: #1f2937; margin-bottom: 1rem;">Zeffy Fundraising Links</h4>
              <div class="link-list">
                <a href="https://www.zeffy.com/en-US/ticketing/icsr2026-international-conference-on-shellfish-restoration" target="_blank" class="link-item">
                  <span>üéüÔ∏è</span>
                  ICSR2026 Tickets
                </a>
                <a href="https://www.zeffy.com/en-US/donation-form/icsr2026-science-without-barriers" target="_blank" class="link-item">
                  <span>üéì</span>
                  Science Without Barriers Fund
                </a>
                <a href="https://www.zeffy.com/en-US/donation-form/isrs-building-tomorrows-ocean-leaders" target="_blank" class="link-item">
                  <span>üåä</span>
                  Building Tomorrow's Leaders Fund
                </a>
              </div>
            </div>

            <div style="margin-top: 1.5rem; text-align: right;">
              <a href="/admin/funding.html" style="color: var(--primary-blue); font-weight: 600; text-decoration: none; font-size: 0.95rem;">View Full Funding Details ‚Üí</a>
            </div>
          </div>
        </div>
      </div>

      <!-- System Status -->
      <div style="background: white; padding: 1.5rem; border-radius: 12px; border: 1px solid #e5e7eb;">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 0.75rem;">
            <span style="font-size: 1.5rem;">üîí</span>
            <div>
              <h3 style="font-size: 1.125rem; font-weight: 700; color: #1f2937; margin-bottom: 0.25rem;">System Status</h3>
              <p style="font-size: 0.875rem; color: #6b7280;">All systems operational</p>
            </div>
          </div>
          <div class="status-badge">
            <span class="status-dot"></span>
            Connected
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Mobile Menu Button -->
  <button class="mobile-menu-btn" onclick="toggleMobileMenu()" style="display: none;">‚ò∞</button>

  <script>
    const API_BASE_URL = 'https://isrs-database-backend.onrender.com';

    // Format number with commas
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // Format currency
    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      }).format(amount);
    }

    // Toggle collapsible sections
    function toggleCollapsible(id) {
      const content = document.getElementById(`${id}-content`);
      const toggle = document.getElementById(`${id}-toggle`);

      if (content.classList.contains('open')) {
        content.classList.remove('open');
        toggle.classList.remove('open');
      } else {
        content.classList.add('open');
        toggle.classList.add('open');
      }
    }

    // Toggle mobile menu
    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('mobile-open');
    }

    // Load dashboard metrics
    async function loadDashboardMetrics() {
      const sessionToken = localStorage.getItem('isrs_session');

      try {
        // Fetch total contacts
        const contactsRes = await fetch(`${API_BASE_URL}/api/admin/contacts`, {
          headers: { 'Authorization': `Bearer ${sessionToken}` }
        });
        const contactsData = await contactsRes.json();
        if (contactsData.success) {
          document.getElementById('metricContacts').textContent = formatNumber(contactsData.data.length);
        }

        // Fetch total organizations
        const orgsRes = await fetch(`${API_BASE_URL}/api/admin/organizations`, {
          headers: { 'Authorization': `Bearer ${sessionToken}` }
        });
        const orgsData = await orgsRes.json();
        if (orgsData.success) {
          document.getElementById('metricOrgs').textContent = formatNumber(orgsData.data.length);
        }

        // Fetch conference registrations (for ICSR2026)
        const regsRes = await fetch(`${API_BASE_URL}/api/admin/conferences`, {
          headers: { 'Authorization': `Bearer ${sessionToken}` }
        });
        const regsData = await regsRes.json();
        if (regsData.success) {
          // Find ICSR2026 conference and count registrations
          const icsr2026 = regsData.data.find(conf => conf.year === 2026);
          const regCount = icsr2026 && icsr2026.registrations ? icsr2026.registrations.length : 0;
          document.getElementById('metricRegistrations').textContent = regCount > 0 ? formatNumber(regCount) : '0';
        }

        // Bank account balances - TODO: integrate with actual API
        document.getElementById('checkingBalance').textContent = 'Contact bank';
        document.getElementById('savingsBalance').textContent = 'Contact bank';

      } catch (error) {
        console.error('Error loading dashboard metrics:', error);
        // Show error state
        document.querySelectorAll('.loading-dots').forEach(el => {
          el.textContent = 'Error';
        });
      }
    }

    // Check authentication on page load
    window.addEventListener('DOMContentLoaded', () => {
      const sessionToken = localStorage.getItem('isrs_session');
      const userEmail = localStorage.getItem('isrs_user_email');
      const userRole = localStorage.getItem('isrs_user_role');

      if (!sessionToken) {
        window.location.href = '/admin/';
        return;
      }

      // Verify session is still valid
      fetch(`${API_BASE_URL}/api/auth/session`, {
        headers: {
          'Authorization': `Bearer ${sessionToken}`
        }
      })
      .then(res => res.json())
      .then(data => {
        if (!data.success) {
          localStorage.clear();
          window.location.href = '/admin/';
        } else {
          // Display user info
          document.getElementById('userEmail').textContent = userEmail;
          document.getElementById('userRole').textContent = userRole;

          // Set avatar initial
          const initial = userEmail.charAt(0).toUpperCase();
          document.getElementById('userAvatar').textContent = initial;

          // Load dashboard metrics
          loadDashboardMetrics();
        }
      })
      .catch(() => {
        localStorage.clear();
        window.location.href = '/admin/';
      });
    });

    async function logout() {
      const sessionToken = localStorage.getItem('isrs_session');

      try {
        await fetch(`${API_BASE_URL}/api/auth/logout`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${sessionToken}`
          }
        });
      } catch (error) {
        console.error('Logout error:', error);
      }

      localStorage.clear();
      window.location.href = '/admin/';
    }

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      const sidebar = document.getElementById('sidebar');
      const mobileBtn = document.querySelector('.mobile-menu-btn');

      if (window.innerWidth <= 1024 &&
          sidebar.classList.contains('mobile-open') &&
          !sidebar.contains(e.target) &&
          !mobileBtn.contains(e.target)) {
        sidebar.classList.remove('mobile-open');
      }
    });
  </script>

  <!-- AI Assistant Sidebar -->
  <div id="aiAssistant" class="ai-assistant-container">
    <!-- Expanded Panel -->
    <div id="aiPanel" class="ai-panel" style="display: none;">
      <div class="ai-panel-content">
        <!-- Header -->
        <div class="ai-header">
          <div class="ai-header-left">
            <div class="ai-icon">ü§ñ</div>
            <div>
              <h3>AI Query Assistant</h3>
              <p class="ai-subtitle">Ask questions about your ISRS and ICSR data</p>
            </div>
          </div>
          <button class="ai-close-btn" onclick="toggleAIPanel()">&times;</button>
        </div>

        <!-- Content Area -->
        <div class="ai-content" id="aiContent">
          <div id="aiExamples">
            <p class="ai-prompt-text">Try asking questions like:</p>
            <div class="ai-examples-list">
              <button class="ai-example-btn" onclick="setAIQuery(this.textContent)">
                <span>‚Üí</span> How many board members do we have?
              </button>
              <button class="ai-example-btn" onclick="setAIQuery(this.textContent)">
                <span>‚Üí</span> Show me all contacts from universities
              </button>
              <button class="ai-example-btn" onclick="setAIQuery(this.textContent)">
                <span>‚Üí</span> List upcoming conferences
              </button>
              <button class="ai-example-btn" onclick="setAIQuery(this.textContent)">
                <span>‚Üí</span> What funding prospects are in the pipeline?
              </button>
              <button class="ai-example-btn" onclick="setAIQuery(this.textContent)">
                <span>‚Üí</span> Show organizations by country
              </button>
              <button class="ai-example-btn" onclick="setAIQuery(this.textContent)">
                <span>‚Üí</span> Recent board votes and their outcomes
              </button>
            </div>
          </div>

          <div id="aiLoading" class="ai-loading-state" style="display: none;">
            <div class="ai-spinner"></div>
            <p>Analyzing your data...</p>
          </div>

          <div id="aiResponse" class="ai-response-area" style="display: none;">
            <!-- Response content will be inserted here -->
          </div>
        </div>

        <!-- Input Area -->
        <div class="ai-input-area">
          <form onsubmit="handleAISubmit(event)">
            <input
              type="text"
              id="aiQueryInput"
              placeholder="Ask a question about your contacts, votes, conferences, or funding..."
              class="ai-input"
            />
            <button type="submit" id="aiSubmitBtn" class="ai-submit-btn">Ask</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Collapsed Tab -->
    <button id="aiTab" class="ai-tab" onclick="toggleAIPanel()">
      <span class="ai-tab-icon">ü§ñ</span>
      <span class="ai-tab-text">AI Assistant</span>
      <span class="ai-tab-arrow">‚Üê</span>
    </button>
  </div>

  <style>
    /* AI Assistant Styles */
    .ai-assistant-container {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
    }

    .ai-panel {
      background: white;
      border-left: 2px solid #3b82f6;
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
      height: 100%;
      width: 450px;
      display: flex;
      flex-direction: column;
    }

    .ai-panel-content {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .ai-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .ai-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .ai-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
    }

    .ai-header h3 {
      font-family: 'Marcellus', Georgia, serif;
      font-size: 1.125rem;
      font-weight: bold;
      color: #111827;
      margin: 0;
    }

    .ai-subtitle {
      font-size: 0.75rem;
      color: #6b7280;
      margin: 0;
    }

    .ai-close-btn {
      color: #9ca3af;
      font-size: 2rem;
      line-height: 1;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      transition: color 0.2s;
    }

    .ai-close-btn:hover {
      color: #4b5563;
    }

    .ai-content {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .ai-prompt-text {
      font-size: 0.875rem;
      color: #4b5563;
      margin-bottom: 1rem;
    }

    .ai-examples-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .ai-example-btn {
      width: 100%;
      text-align: left;
      padding: 0.75rem 1rem;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.875rem;
      color: #374151;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'PT Serif', Georgia, serif;
    }

    .ai-example-btn:hover {
      background: #eff6ff;
      border-color: #3b82f6;
      color: #1e40af;
    }

    .ai-example-btn span {
      color: #3b82f6;
      margin-right: 0.5rem;
    }

    .ai-loading-state {
      text-align: center;
      padding: 3rem 0;
    }

    .ai-spinner {
      display: inline-block;
      width: 48px;
      height: 48px;
      border: 3px solid #f3f4f6;
      border-top-color: #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    .ai-loading-state p {
      color: #6b7280;
    }

    .ai-response-area {
      /* Response styles will be added dynamically */
    }

    .ai-input-area {
      border-top: 1px solid #e5e7eb;
      padding: 1rem;
    }

    .ai-input-area form {
      display: flex;
      gap: 0.5rem;
    }

    .ai-input {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 0.875rem;
      font-family: 'PT Serif', Georgia, serif;
      transition: border-color 0.2s;
    }

    .ai-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .ai-submit-btn {
      padding: 0.75rem 1.5rem;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      font-family: 'PT Serif', Georgia, serif;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .ai-submit-btn:hover {
      background: #2563eb;
    }

    .ai-submit-btn:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }

    .ai-tab {
      position: absolute;
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
      color: white;
      border: none;
      padding: 20px 12px;
      border-top-left-radius: 8px;
      border-bottom-left-radius: 8px;
      cursor: pointer;
      box-shadow: -2px 2px 8px rgba(0, 0, 0, 0.2);
      writing-mode: vertical-rl;
      text-orientation: mixed;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s;
    }

    .ai-tab:hover {
      background: linear-gradient(to bottom, #2563eb, #7c3aed);
      box-shadow: -4px 4px 12px rgba(0, 0, 0, 0.3);
    }

    .ai-tab-icon {
      font-size: 1.25rem;
    }

    .ai-tab-text {
      font-family: 'PT Serif', Georgia, serif;
      font-weight: 500;
      white-space: nowrap;
    }

    .ai-tab-arrow {
      margin-top: 0.5rem;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>

  <script>
    function toggleAIPanel() {
      const panel = document.getElementById('aiPanel');
      const tab = document.getElementById('aiTab');

      if (panel.style.display === 'none') {
        panel.style.display = 'flex';
        tab.style.display = 'none';
        document.getElementById('aiQueryInput').focus();
      } else {
        panel.style.display = 'none';
        tab.style.display = 'flex';
      }
    }

    function setAIQuery(text) {
      document.getElementById('aiQueryInput').value = text;
      document.getElementById('aiQueryInput').focus();
    }

    async function handleAISubmit(event) {
      event.preventDefault();
      const input = document.getElementById('aiQueryInput');
      const query = input.value.trim();

      if (!query) return;

      const submitBtn = document.getElementById('aiSubmitBtn');
      const examples = document.getElementById('aiExamples');
      const loading = document.getElementById('aiLoading');
      const response = document.getElementById('aiResponse');

      // Hide examples, show loading
      examples.style.display = 'none';
      loading.style.display = 'block';
      response.style.display = 'none';
      submitBtn.disabled = true;
      submitBtn.textContent = 'Analyzing...';

      try {
        const sessionToken = localStorage.getItem('isrs_session');
        const res = await fetch('https://isrs-database-backend.onrender.com/api/admin/ai-query', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${sessionToken}`
          },
          body: JSON.stringify({ question: query, includeInsights: true })
        });

        const data = await res.json();

        loading.style.display = 'none';

        if (data.success) {
          // Display response
          response.innerHTML = `
            <div class="ai-response-content">
              <div class="ai-response-header">
                <h4 style="font-family: 'Marcellus', Georgia, serif; color: #111827; margin: 0 0 1rem 0;">Results</h4>
                <button onclick="clearAIResponse()" style="color: #3b82f6; font-size: 0.875rem; background: none; border: none; cursor: pointer;">New Query</button>
              </div>

              ${data.insights ? `
                <div style="padding: 1rem; background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; margin-bottom: 1rem;">
                  <p style="margin: 0; font-size: 0.875rem; color: #1e40af;">${data.insights}</p>
                </div>
              ` : ''}

              <div style="background: #1a202c; color: #e2e8f0; padding: 1rem; border-radius: 6px; font-family: monospace; font-size: 0.8125rem; overflow-x: auto; margin-bottom: 1rem;">
                ${data.sql}
              </div>

              <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;"><strong>Results (${data.rowCount} rows):</strong></p>

              ${data.rows && data.rows.length > 0 ? `
                <div style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                  <table style="width: 100%; border-collapse: collapse; font-size: 0.8125rem;">
                    <thead style="background: #f9fafb;">
                      <tr>
                        ${Object.keys(data.rows[0]).map(col => `
                          <th style="padding: 0.75rem; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">${col}</th>
                        `).join('')}
                      </tr>
                    </thead>
                    <tbody>
                      ${data.rows.map(row => `
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                          ${Object.values(row).map(val => `
                            <td style="padding: 0.75rem; color: #4b5563;">${val !== null && val !== undefined ? val : '-'}</td>
                          `).join('')}
                        </tr>
                      `).join('')}
                    </tbody>
                  </table>
                </div>
              ` : '<p style="text-align: center; color: #6b7280; padding: 2rem;">No results found</p>'}
            </div>
          `;
          response.style.display = 'block';
        } else {
          response.innerHTML = `
            <div style="padding: 1rem; background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px;">
              <p style="margin: 0; font-size: 0.875rem; color: #991b1b;">${data.error || 'Query failed'}</p>
            </div>
          `;
          response.style.display = 'block';
        }
      } catch (error) {
        loading.style.display = 'none';
        response.innerHTML = `
          <div style="padding: 1rem; background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px;">
            <p style="margin: 0; font-size: 0.875rem; color: #991b1b;">Error: ${error.message}</p>
          </div>
        `;
        response.style.display = 'block';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Ask';
      }
    }

    function clearAIResponse() {
      document.getElementById('aiResponse').style.display = 'none';
      document.getElementById('aiExamples').style.display = 'block';
      document.getElementById('aiQueryInput').value = '';
      document.getElementById('aiQueryInput').focus();
    }

    // ESC key to close AI panel
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' || event.key === 'Esc') {
        const panel = document.getElementById('aiPanel');
        if (panel.style.display !== 'none') {
          toggleAIPanel();
        }
      }
    });
  </script>
</body>
</html>
